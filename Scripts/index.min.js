require(["esri/map","esri/graphic","esri/geometry/Extent","esri/SpatialReference","esri/config","esri/domUtils","esri/layers/FeatureLayer","esri/tasks/query","esri/InfoTemplate","esri/dijit/BasemapGallery","esri/Color","esri/symbols/CartographicLineSymbol","esri/geometry/webMercatorUtils","esri/renderers/UniqueValueRenderer","esri/symbols/SimpleMarkerSymbol","esri/urlUtils","esri/dijit/PopupMobile","esri/layers/ArcGISDynamicMapServiceLayer","esri/tasks/QueryTask","esri/dijit/HomeButton","esri/dijit/Geocoder","dojo/promise/all","elc","dojo/domReady!"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function oi(){document.getElementById("results").classList.add("hidden")}function si(){document.getElementById("results").classList.remove("hidden")}function hi(){function r(){return!1}for(var n=document.querySelectorAll(".disabled > a"),t,i=0;i<n.length;i++)t=n[0],t.onclick=r}function ci(){var t=document.forms.clearanceForm,i=p.urlToObject(location.toString()),n=i.query;n&&(n.feet&&(t.feet.value=n.feet),n.inches&&(t.inches.value=n.inches),n.route&&(t.route.value=n.route),n.hasOwnProperty("include-non-mainline")&&(t["include-non-mainline"].checked=/^(?:(?:true)|1|(?:yes))$/i.test(n["include-non-mainline"])),t.onsubmit())}function at(){var i,u,n,f,r,t,e;for(i=document.getElementById("topNavBar"),u=document.getElementById("map"),f=document.getElementById("sidebar"),n=window.innerHeight-i.clientHeight-40,n=[n,"px"].join(""),u.style.height=n,f.style.height=n,r=document.querySelectorAll(".tab-pane"),n=window.innerHeight-i.clientHeight-80,n=[n,"px"].join(""),t=0,e=r.length;t<e;t+=1)r[t].style.height=n}function vt(n){var t=0;return ht<=n.attributes.VCMAX&&(t=1),t}function yt(n){var r,t,i;return typeof n=="number"?(t=n%100,r=(n-t)/100,i=r*12+t):i=n,i}function ni(n){var i,t;return t=n%12,i=(n-t)/12,i*100+t}function pt(n){var t=n%12,i=(n-t)/12;return[i,"'",t,'"'].join("")}function ft(n,t){this.feet=n?Number(n):0;this.inches=t?Number(t):0}function li(n){var i=n.geometry,t,r=null;return t=i.type==="point"?[i.x,i.y]:i.paths?i.paths[0][0]:null,t=a.xyToLngLat(t[0],t[1]),t&&(r=["http://maps.google.com/maps?q=&layer=c&cbll=",t[1],",",t[0],"&cbp=11,0,0,0,0"].join("")),r}function ti(n){var r,u,i,f,e={SRMP:"Milepost"},t;r=document.createElement("table");r.classList.add("table");for(t in n)n.hasOwnProperty(t)&&(u=r.insertRow(-1),i=document.createElement("th"),i.textContent=e.hasOwnProperty(t)?e[t]:t,f=n[t],u.appendChild(i),i=u.insertCell(-1),typeof f=="object"?i.appendChild(ti(f)):i.textContent=n[t]);return r}function ai(n){var r,t,i,u;if(n&&n.fields)for(r={},i=0,u=n.fields.length;i<u;i+=1)t=n.fields[i],r[t.name]=t.alias||t.name;return r}function vi(n,t,i){var u=document.createElement("table"),f,e,o,r,h,s,c;return s=n.attributes,c=ai(n.getLayer()),u.setAttribute("class","bridge-info table table-striped table-hover"),u.createTHead(),h=u.createTBody(),t&&t.forEach(function(n){s.hasOwnProperty(n)&&(f=document.createElement("tr"),e=document.createElement("th"),e.textContent=c[n],f.appendChild(e),o=document.createElement("td"),r=s[n],i&&i.test(n)&&r>0&&(r=pt(yt(r)-3)),o.textContent=r,f.appendChild(o),h.appendChild(f))}),u}function yi(n){var t,r=n.target,u,i;return t=document.querySelector("table.bridge-info"),i=document.createElement("span"),r.innerHTML="",t&&(t.classList.contains("collapsed")?(t.classList.remove("collapsed"),u=document.createTextNode("Hide Details "),i.setAttribute("class","glyphicon glyphicon-chevron-up")):(t.classList.add("collapsed"),u=document.createTextNode("Details... "),i.setAttribute("class","glyphicon glyphicon-chevron-down")),r.appendChild(u),r.appendChild(i)),!1}function pi(n){var t=[];return n&&n.attributes&&(n.attributes.hasOwnProperty("lrs_traffic_flow_beg")&&t.push(n.attributes.lrs_traffic_flow_beg),n.attributes.lrs_traffic_flow_end&&t.push(n.attributes.lrs_traffic_flow_end)),t.join(" — ")}function wi(n){var l,e,a,u,i,t,h,o,c;l=["structure_id","bridge_no","crossing_description","facilities_carried","feature_intersected","structure_length"];var r=document.createDocumentFragment(),s=yt(n.attributes.VCMIN),f=yt(n.attributes.VCMAX);return s>3&&(s-=3),f&&f>3&&(f-=3),e={},e["Vertical Clearance"]={Minimum:pt(s),Maximum:pt(f)},e.SRMP=pi(n),a=ti(e),r.appendChild(a),u=document.createElement("ul"),u.setAttribute("class","link-list"),r.appendChild(u),h=li(n),h&&(i=document.createElement("li"),i.setAttribute("class","google-street-view"),t=document.createElement("a"),t.setAttribute("class","google-street-view"),t.href=h,t.textContent="Google Street View",t.target="_blank",i.appendChild(t),u.appendChild(i)),i=document.createElement("li"),t=document.createElement("a"),t.href="http://www.wsdot.wa.gov/CommercialVehicle/county_permits.htm",t.target="_blank",t.textContent="Local agency contacts",i.appendChild(t),u.appendChild(i),o=vi(n,l,gt),o.classList&&(o.classList.add("collapsed"),c=document.createElement("p"),t=document.createElement("a"),t.href="#",t.innerHTML="Details...<span class='glyphicon glyphicon-chevron-down'><\/span>",t.onclick=yi,c.appendChild(t),r.appendChild(c)),r.appendChild(o),r}function st(n){var t=Number(n.getAttribute("data-on-count")),i=Number(n.getAttribute("data-under-count"));n.textContent=t+i}function ii(n){var t,i,r,f,e,u;t=document.getElementById("noPassCount");i=document.getElementById("somePassCount");e=n.features.length;r=n.features.filter(function(n){return!!vt(n)}).length;f=e-r;u=n.target.id==="bridge-on"?"data-on-count":"data-under-count";t.setAttribute(u,f);i.setAttribute(u,r);st(t);st(i)}function ri(){var n,t,i;n=document.getElementById("noPassCount");t=document.getElementById("somePassCount");i=this.id==="bridge-on"?"data-on-count":"data-under-count";n.setAttribute(i,0);t.setAttribute(i,0);st(n);st(t)}function ui(n){console.error("layer error",n);document.head.innerHTML="";document.body.innerHTML="<p>A problem was encountered contacting the bridge services. Please try again later.<\/p>"}function bi(n){var r,i,u=!1,t,f;for(r=document.getElementsByTagName("datalist")[0],i=r.querySelectorAll("option"),t=0,f=i.length;t<f;t+=1)if(i[t].value===n.value){u=!0;break}return u}function ki(n){var t;return n&&/^\d+$/.test(n)&&(n.length===1?t="00"+n:n.length===2&&(t="0"+n)),t||n}function di(){var n,r,t,i;return n=document.forms.clearanceForm,n.feet.value||n.inches.value?(document.getElementById("heightRequiredWarning").classList.add("hidden"),r=new ft(n.feet.value,n.inches.value),i=document.getElementById("tooHighWarning"),r.totalInches()>192?(i.classList.remove("hidden"),t=!1):i.classList.add("hidden")):(document.getElementById("heightRequiredWarning").classList.remove("hidden"),t=!1),n.route.value&&(bi(n.route)?document.getElementById("invalidRouteAlert").classList.add("hidden"):(document.getElementById("invalidRouteAlert").classList.remove("hidden"),t=!1)),t!==!1&&(t=!0),t}function fi(n,t,i,r){var u=[n," < ",ni(t+3)],e="lrs_route",f;return i?(i=ki(i),r?u.push(" AND ",e,"= '",i,"'"):u.push(" AND ",e," LIKE '",i,"%'")):r&&u.push(" AND LEN(lrs_route) = 3"),f=new o,f.where=u.join(""),f}function gi(n){function h(n){var r=0,i;n.forEach(function(n){n.length>=1&&(r+=n.length)});r===0&&(i=["No bridges found lower than ",t.feet,"′"],t.inches&&i.push(t.inches,"″"),t.route&&i.push(" on route ",t.route),alert(i.join("")));si()}var r,f,i,u,t,e,o,s;if(e=di(),e){t={feet:n.feet.value,inches:n.inches.value,route:n.route.value,"include-non-mainline":document.getElementById("includeNonMainlineCheckbox").checked};try{n.blur();f=new ft(n.feet.value,n.inches.value);r=f.totalInches();i=n.route.value;!i||/^\d+$/.test(i)||/^\d{3}(?:(\w{2})(\w{0,6}))?$/.test(i)?(u=!document.getElementById("includeNonMainlineCheckbox").checked,r&&(ht=ni(r+3),o=rt.selectFeatures(fi("VCMIN",r,i,u)),s=ut.selectFeatures(fi("VCMIN",r,i,u)),nt([o,s]).then(h))):(alert("Invalid route"),t=null)}catch(c){console.error(c);t=null}return t}}function nr(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push([t,encodeURIComponent(n[t])].join("="));return"?"+i.join("&")}function ei(){it.infoWindow.hide()}function tr(n){var r={attributes:{},geometry:n.RouteGeometry,infoTemplate:{title:"${Route} @ MP ${Srmp}",content:"<dl><dt>Route<\/dt><dd>${Route}<\/dd><dt>Milepost<\/dt><dd>${Srmp}<\/dd><\/dl>"}};for(var i in n)n.hasOwnProperty(i)&&!/(?:(?:Geometry)|(?:Point)|(?:id))/i.test(i)&&n[i]!=null&&(r.attributes[i]=n[i]);return new t(r)}var it,rt,ut,ht,kt,dt,ct,lt,gt,ot,wt,bt,et;ct=new tt.RouteLocator,function(n){for(var i,r=function(n){var t=n.key||n.keyIdentifier,i=t.match(/U\+(\d+)/);i&&(t=String.fromCharCode(Number.parseInt(i[1],16)));console.log(t);t.length===1&&/[^0-9\t]/.test(t)&&(/[\b]/.test(t)||n.preventDefault())},t=0,u=n.length;t<u;t+=1)i=n[t],i.onkeydown=r}(document.querySelectorAll("input[type=number],#routeFilterBox"));hi();kt="http://www.wsdot.wa.gov/geosvcs/ArcGIS/rest/services/Bridges_QA/BridgeVerticalClearances_0_1/MapServer/1";dt="http://www.wsdot.wa.gov/geosvcs/ArcGIS/rest/services/Bridges_QA/BridgeVerticalClearances_0_1/MapServer/0";gt=/^(?:(?:horiz_clrnc_route)|(?:horiz_clrnc_rvrs)|(?:vert_clrnc_route_max)|(?:vert_clrnc_route_min)|(?:vert_clrnc_rvrs_max)|(?:vert_clrnc_rvrs_min)|(?:min_vert_(?:(?:deck)|(?:under))))$/i;$("#tabs a").click(function(n){n.preventDefault();$(this).tab("show")});$("[data-toggle=offcanvas]").click(function(){var n;$(".row-offcanvas").toggleClass("active");n=this.querySelector("span");$(n).toggleClass("glyphicon-list").toggleClass("glyphicon-globe")});at();window.addEventListener("resize",at,!0);window.addEventListener("deviceorientation",at,!0);u.defaults.io.proxyUrl="proxy/proxy.ashx";["www.wsdot.wa.gov"].forEach(function(n){u.defaults.io.corsEnabledServers.push(n)});ot=new i({xmin:-14058520.2360666,ymin:5539437.0343902,ymax:6499798.10086703,xmax:-12822768.6769759,spatialReference:{wkid:3857}});wt={extent:ot,lods:[{level:0,resolution:156543.033928,scale:591657527.591555},{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176}],minZoom:7,maxZoom:19,showAttribution:!0};lt=document.body.clientWidth<768;lt&&(wt.infoWindow=new w(null,document.createElement("div")));it=new n("map",wt);ft.prototype.totalInches=function(){return this.feet*12+this.inches};ft.prototype.totalFeet=function(){return this.feet+this.inches/12};ft.prototype.toWeirdoFormat=function(){return this.feet*100+this.inches};ft.prototype.toString=function(){return[this.feet.toString(),"'",this.inches.toString(),'"'].join("")};bt=new s("${crossing_description}",wi);new d({map:it},"homeButton").startup();new g({map:it,autoComplete:!0,highlightLocation:!0,arcgisGeocoder:{sourceCountry:"US",searchExtent:ot,placeholder:"Find an address"}},"geocoder");it.on("load",function(){function w(n){var t;t=document.getElementById("hovertext");t||(t=document.createElement("div"),t.id="hovertext",document.body.appendChild(t));t.textContent=n.graphic.attributes.crossing_description;t.setAttribute("style",["position: fixed; left: ",n.clientX,"px; top: ",n.clientY,"px; display: block"].join(""));console.log("mouse-over",n)}function k(){var n=document.getElementById("hovertext");n&&n.setAttribute("style","display: none")}var s,h,a,p,t,i,r,u,n,f,o;s=new b("http://www.wsdot.wa.gov/geosvcs/ArcGIS/rest/services/Shared/MilepostValues/MapServer",{id:"mileposts"});it.addLayer(s);r=new c([255,0,0,255]);u=new c([255,255,0,255]);n=lt?20:10;a=new l(l.STYLE_SOLID,r,n,l.CAP_ROUND,l.JOIN_MITER,5);p=new l(l.STYLE_SOLID,u,n,l.CAP_ROUND,l.JOIN_MITER,5);h=(new y).setColor(r).setSize(n).setOutline(null);f="Can pass in some lanes";o="Vehicle may be able to pass in some but not all lanes.";i=new v(a,vt);i.addValue({value:1,symbol:p,label:f,description:o});t=new v(h,vt);t.addValue({value:1,symbol:(new y).setColor(u).setSize(n).setOutline(null),label:f,description:o});rt=new e(kt,{id:"bridge-on",mode:e.MODE_SELECTION,outFields:["*"],infoTemplate:bt});rt.setRenderer(i);rt.on("selection-complete",ii);rt.on("selection-clear",ri);ut=new e(dt,{id:"bridge-under",mode:e.MODE_SELECTION,outFields:["*"],infoTemplate:bt});ut.setRenderer(t);ut.on("selection-complete",ii);ut.on("selection-clear",ri);rt.on("error",ui);ut.on("error",ui);rt.on("mouse-over",w);rt.on("mouse-out",k);ut.on("mouse-over",w);ut.on("mouse-out",k);it.addLayer(rt);it.addLayer(ut);ci()});et=new h({map:it,basemapsGroup:{id:"a89e08f2cc584e55a23b76fa7c9b8618"}},"basemapGallery");et.startup();et.on("load",function(){var t,n=et.basemaps.filter(function(n){return n.title==="WSDOT Base Map"});n&&n.length>0&&(t=n[0],et.select(t.id))});it.on("update-end",function(){f.hide(document.getElementById("mapProgress"))});it.on("update-start",function(){f.show(document.getElementById("mapProgress"))});document.forms.clearanceForm.onsubmit=function(){var n=gi(this);return n&&history&&history.replaceState(n,document.title,nr(n)),!1};document.forms.clearanceForm.onreset=function(){oi();rt.clearSelection();ut.clearSelection();ht=null;history&&history.replaceState({feet:null,inches:null,route:null,"include-non-mainline":null},document.title,location.pathname);document.getElementById("heightRequiredWarning").classList.add("hidden");document.getElementById("tooHighWarning").classList.add("hidden");document.getElementById("invalidRouteAlert").classList.add("hidden");it.setExtent(ot)};$("#warningModal").modal();document.forms.clearanceForm.addEventListener("reset",ei);document.forms.clearanceForm.addEventListener("submit",ei),function(){ct.getRouteList(function(n){var u,i,t,r;typeof n=="string"&&(n=JSON.parse(n));r=n.Current;r.sort(function(n,t){return n.name===t.name?0:n.name>t.name?1:-1});u=document.getElementById("routeFilterBox");i=document.createElement("datalist");i.id="routeList";r.forEach(function(n){var r;n.name.length<=3&&(r=Number(n.name),t=document.createElement("option"),t.value=r,t.textContent=r,t.setAttribute("data-lrs-types",n.lrsTypes),i.appendChild(t))});document.body.appendChild(i)})}(),function(n,t){var i,r,u,f;for(f=function(){n.onsubmit()},i=0,r=t.length;i<r;i++)u=t[i],u.addEventListener("change",f)}(document.getElementById("clearanceForm"),document.getElementById("clearanceForm").querySelectorAll("input"));it.on("click",function(n){var t;/(?:(?:circle)|(?:path))/i.test(n.target.tagName)||(t=n.mapPoint,ct.findNearestRouteLocations({coordinates:[t.x,t.y],referenceDate:new Date,searchRadius:200,inSR:t.spatialReference.wkid,outSR:t.spatialReference.wkid,useCors:!0,successHandler:function(n){n.length&&(it.infoWindow.setFeatures(n.map(tr)),it.infoWindow.show(t))},errorHandler:function(n){console.log("elc error",n)}}))})});
//# sourceMappingURL=index.min.js.map
